
syntax = "proto3";

package book;

option go_package="github.com/josemqz/SistDistribuidos/Lab2/book;book";


message Chunk{
    string remitente = 1;
    string nombreLibro = 2;
    int32 numChunk = 3;
    string contenido = 5;
}

// Mensaje inicial a DataNode
message ChunksInfo{
    string remitente = 1;
    string nombreLibro = 2;
    int32 cantChunks = 3;
    string info = 4;
}

message LibroInfo{
    string nombreLibro = 1;
    int32 sizeLibro = 2;
}

message PropuestaLibro{
    string nombreLibro = 1;
    string propuesta = 2;
    bool estadoP = 3;
    int32 cantChunks = 4;
    //si la propuesta considera usar datanode a b c
    bool datanodeA = 5;
    bool datanodeB = 6;
    bool datanodeC = 7;
}

message ACK{
    string ok = 1;
}

service BookService{
    
    rpc GenerarPropuesta(LibroInfo) returns (ACK) {}

    //enviar propuesta de un datanode a x 

    rpc RecibirChunksInfo(ChunksInfo) returns (ACK) {}
    rpc RecibirChunk(Chunk) returns (ACK) {}
    rpc RecibirChunks(stream Chunk) returns (ACK) {}


    //exclusi√≥n mutua (?)

}